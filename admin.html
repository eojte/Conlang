<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Conlang Admin Panel</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    max-width: 600px;
    margin: 30px auto;
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  input, select, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  button {
    background-color: #4caf50;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background-color: #45a049;
  }
  #log {
    width: 100%;
    height: 180px;
    font-family: monospace;
    background: white;
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 10px;
    overflow-y: auto;
    white-space: pre-wrap;
  }
</style>
</head>
<body>

<h1>Conlang Admin Panel</h1>

<input id="english" placeholder="English word" />
<input id="conlang" placeholder="Conlang word" />
<input id="category" placeholder="Type (e.g. noun, verb)" />
<input id="root" placeholder="Root word (optional)" />

<select id="action">
  <option value="add">Add</option>
  <option value="edit">Edit</option>
  <option value="delete">Delete</option>
  <option value="search">Search</option>
</select>

<button onclick="performAction()">Perform Action</button>

<div id="log" readonly></div>

<script>
  const repo = "eojte/Conlang"; // Your GitHub repo
  const filePath = "conlang_dict.json";
  const token = "YOUR_TOKEN_HERE"; // Replace with your GitHub token

  let dictionary = [];
  let fileSha = "";

  async function loadData() {
    try {
      const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`);
      if (!res.ok) throw new Error('Failed to fetch dictionary');
      const data = await res.json();
      fileSha = data.sha;
      const content = atob(data.content);
      dictionary = JSON.parse(content);
      log(`Loaded ${dictionary.length} words.`);
    } catch (e) {
      log("Error loading dictionary: " + e.message);
    }
  }

  function log(msg) {
    const logBox = document.getElementById("log");
    logBox.textContent += msg + "\n";
    logBox.scrollTop = logBox.scrollHeight;
  }

  async function saveData() {
    const content = btoa(JSON.stringify(dictionary, null, 2));
    const res = await fetch(`https://api.github.com/repos/${repo}/contents/${filePath}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: `token ${token}`
      },
      body: JSON.stringify({
        message: "Update dictionary via admin panel",
        content,
        sha: fileSha
      })
    });

    if (res.ok) {
      const data = await res.json();
      fileSha = data.content.sha;
      log("Saved changes to GitHub.");
    } else {
      const err = await res.json();
      log("Error saving: " + (err.message || "Unknown error"));
    }
  }

  async function performAction() {
    const english = document.getElementById("english").value.trim().toLowerCase();
    const conlang = document.getElementById("conlang").value.trim().toLowerCase();
    const category = document.getElementById("category").value.trim().toLowerCase();
    const rootVal = document.getElementById("root").value.trim().toLowerCase() || null;
    const action = document.getElementById("action").value;

    if (["add", "edit"].includes(action)) {
      if (!english || !conlang || !category) {
        log("Please fill English, Conlang, and Type fields.");
        return;
      }
    }

    switch(action) {
      case "add":
        if (dictionary.some(w => w.english === english || w.conlang === conlang)) {
          log(`Word "${english}" or "${conlang}" already exists. Use Edit to modify.`);
          break;
        }
        dictionary.push({english, conlang, category, root: rootVal});
        log(`Added word: ${english} - ${conlang} (${category})`);
        await saveData();
        break;

      case "edit":
        const toEdit = dictionary.find(w => w.english === english || w.conlang === conlang);
        if (!toEdit) {
          log(`Word "${english}" not found for editing.`);
          break;
        }
        toEdit.english = english;
        toEdit.conlang = conlang;
        toEdit.category = category;
        toEdit.root = rootVal;
        log(`Edited word: ${english} - ${conlang} (${category})`);
        await saveData();
        break;

      case "delete":
        if (!english && !conlang) {
          log("Provide English or Conlang word to delete.");
          break;
        }
        const beforeLen = dictionary.length;
        dictionary = dictionary.filter(w => !(w.english === english || w.conlang === conlang));
        if (dictionary.length === beforeLen) {
          log("No matching word found to delete.");
        } else {
          log(`Deleted word "${english || conlang}".`);
          await saveData();
        }
        break;

      case "search":
        if (!english && !conlang && !category) {
          log("Please enter English, Conlang or Type to search.");
          break;
        }
        const results = dictionary.filter(w => 
          (english && w.english.includes(english)) ||
          (conlang && w.conlang.includes(conlang)) ||
          (category && w.category.includes(category))
        );
        if (results.length === 0) {
          log("No matches found.");
        } else {
          log(`Found ${results.length} result(s):`);
          results.forEach(w => {
            log(`â€¢ ${w.english} - ${w.conlang} [${w.category}]${w.root ? " (root: "+w.root+")" : ""}`);
          });
        }
        break;

      default:
        log("Invalid action.");
    }
  }

  loadData();
</script>

</body>
</html>
